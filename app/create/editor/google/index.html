<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<script src="/library/blockly/google-blockly-c455689/blockly_compressed.js"></script>
		<script src="/library/blockly/google-blockly-c455689/msg/js/en.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
		<script src="/library/blockly/html/blocks.js"></script>
		<script src="/library/blockly/html/generator.js"></script>
		<script defer src="https://use.fontawesome.com/releases/v5.0.2/js/all.js"></script>
		<link rel="stylesheet" href="/library/blockly/html/layout.css">
		<link rel="stylesheet" href="/library/standard.css">
		<title>CodeDragon : Editor</title>
	</head>
	<body>
		<nav>
			<a href="/">
				<svg class="nav-brand" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 356.98 167.2"><path d="M947.79,537.39Q945,563.1,929.41,576.73t-41.52,13.64q-18.1,0-32-9t-21.52-25.65q-7.59-16.6-7.71-37.95V496.6q0-21.69,7.6-38.45t21.85-25.87q14.25-9.11,32.81-9.11,26.15,0,41.29,14.08t17.6,39H933.94q-5.15-41.47-45-41.47-22.14,0-35.27,16.56T840.5,497.09V517q0,28.18,12.8,45t34.59,16.77q21.57,0,32.52-10.33t13.53-31Z" transform="translate(-826.64 -423.17)"/><path d="M983,588.13V425.4h45a66.49,66.49,0,0,1,34.2,9,63.06,63.06,0,0,1,24,25.09,76.74,76.74,0,0,1,8.94,36.15v21.13q0,20.34-8.55,36.65a63.24,63.24,0,0,1-23.86,25.49,66.06,66.06,0,0,1-34.2,9.27Zm6-156.69V582.1h39a59.85,59.85,0,0,0,31.13-8.33,58.2,58.2,0,0,0,22-23.25,70.43,70.43,0,0,0,8-33.13v-20.9a70.34,70.34,0,0,0-7.77-33.09,58.3,58.3,0,0,0-21.68-23.3,59.89,59.89,0,0,0-30.79-8.66Z" transform="translate(-826.64 -423.17)"/><path d="M1183,471.67l-7.83-.67q-15.42,0-25.81,10t-13.64,28v79.16h-6V467.2h6v25.15a44.51,44.51,0,0,1,14.75-20q9.84-7.38,24.7-7.38a24.1,24.1,0,0,1,8.5,1.25Z" transform="translate(-826.64 -423.17)"/></svg>
			</a>
			<ul class="nav-items">
				<li class="nav-item"><a href="/">Home</a></li>
				<li class="nav-item"><a href="#">About</a></li>
				<li class="nav-item"><a href="#">Contact</a></li>
				<li class="nav-item"><a href="/php/user/signout">Sign out</a></li>
				<li class="nav-item important"><a href="/user/home">Dashboard</a></li>
			</ul>
		</nav>
		<div class="container">
			<div class="row">
				<div class="col12 bottom">
					<button onclick="saveCode()" class="btn"><i class="fas fa-download"></i></button>
					<button onclick="loadCode()" id="loadi" class="btn"><i class="fas fa-upload"></i></button>
					<input class="load" id="loadText" type="file">
					<button onclick="doLoad()" class="load btn">Load</button>
					<div class="right">
						<button class="btn"><i class="fas fa-backward"></i></button>
						<button class="btn"><i class="fas fa-save"></i></button>
						<button onclick="clearCode()" class="btn"><i class="fas fa-trash"></i></button><br/>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col8">
					<div id="blocklyDiv" style="height: 480px;"></div>
				</div>
				<div id="preview" class="col4">
					<iframe id="preview-frame" name="prev"></iframe>
					<pre><code id="code-output" class="html"></code></pre>
				</div>
			</div>
			<xml id="toolbox" style="display: none">
				<category name="Structure" colour="210">
					<category name="Page" colour="210">
						<block type="html"></block>
						<block type="head"></block>
						<block type="body"></block>
						<block type="title"></block>
					</category>
					<category name="Layout" colour="210">
						<block type="divider"></block>
						<block type="linebreak"></block>
						<block type="hline"></block>
					</category>
				</category>
				<category name="Modifiers" colour="120">
					<block type="args"></block>
					<block type="class"></block>
					<block type="id"></block>
					<block type="emptyarg"></block>
				</category>
				<category name="Text" colour="65">
					<block type="emptytext"></block>
					<block type="span"></block>
					<block type="paragraph"></block>
					<block type="header"></block>
					<block type="link"></block>
				</category>
				<category name="Style" colour="290">
					<category name="Structure" colour="290">
						<block type="style"></block>
						<block type="cssitem"></block>
					</category>
					<category name="Items" colour="290">
						<block type="fontfamily"></block>
						<block type="fontsize"></block>
						<block type="margin"></block>
						<block type="othercss"></block>
					</category>
				</category>
			</xml>
		</div>
		<script>
			$(document).ready(function(){
				$('.load').hide();
			});
			var workspace = Blockly.inject('blocklyDiv',{toolbox: document.getElementById('toolbox')});
			window.document.domain = "cdbeta.hma-uk.org";
			function onUpdate(event){
				var code = htmlGen.workspaceToCode(workspace);
				var iframe = document.getElementById('preview-frame');
				$('#code-output').text(code);
				iframe.src = "data:text/html;charset=utf-8," + encodeURIComponent(code);
			}
			workspace.addChangeListener(onUpdate);
			function saveCode(){
				var xml = Blockly.Xml.workspaceToDom(workspace);
				var xml_text = Blockly.Xml.domToText(xml);
				download('code.cdr',xml_text);
			}
			function clearCode(){
				if(confirm("Are you sure you want to reset the Ffau?")){
					Blockly.mainWorkspace.clear();
				}
			}
			function loadCode(){
				$('.load').show();
				$('#loadi').hide();
			}
			function doLoad(){
				var fileToLoad = document.getElementById('loadText').files[0];
				var fileReader = new FileReader();
				fileReader.onload = function(fileLoadedEvent){
					var textFromFileLoaded = fileLoadedEvent.target.result;
					var xml = Blockly.Xml.textToDom(textFromFileLoaded);
					Blockly.Xml.domToWorkspace(xml, workspace);
					$('.load').hide();
					$('#loadi').show();
				};
				fileReader.readAsText(fileToLoad, "UTF-8");
			}
			function download(filename, text) {
				var element = document.createElement('a');
				element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
				element.setAttribute('download', filename);
				element.style.display = 'none';
				document.body.appendChild(element);
				element.click();
				document.body.removeChild(element);
			}
		</script>
	</body>
</html>
